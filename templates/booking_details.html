{% extends "layout.html" %}

{% block title %}–î–µ—Ç–∞–ª—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è - {{ booking.booking_code }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card booking-confirmation mb-4">
            <div class="card-body text-center text-light">
                <h1 class="card-title">‚úÖ –ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!</h1>
                <h3 class="card-subtitle mb-3 text-gold">–ö–æ–¥ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è: <strong>{{ booking.booking_code }}</strong></h3>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-body">
                <h4 class="card-title text-gold">–î–µ—Ç–∞–ª—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</h4>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <h5 class="text-silver mb-3">üìΩÔ∏è –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ñ—ñ–ª—å–º</h5>
                        <p class="text-light"><strong class="text-silver">–§—ñ–ª—å–º:</strong> {{ booking.film_title }}</p>
                        <p class="text-light"><strong class="text-silver">–î–∞—Ç–∞:</strong> {{ booking.session_date }}</p>
                        <p class="text-light"><strong class="text-silver">–ß–∞—Å:</strong> {{ booking.session_time }}</p>
                        <p class="text-light"><strong class="text-silver">–ó–∞–ª:</strong> {{ booking.hall_name }}</p>
                    </div>
                    
                    <div class="col-md-6">
                        <h5 class="text-silver mb-3">üë§ –í–∞—à—ñ –¥–∞–Ω—ñ</h5>
                        <p class="text-light"><strong class="text-silver">–Ü–º'—è:</strong> {{ booking.customer_name }}</p>
                        <p class="text-light"><strong class="text-silver">Email:</strong> {{ booking.customer_email }}</p>
                        <p class="text-light"><strong class="text-silver">–°—Ç–∞—Ç—É—Å:</strong> 
                            <span class="badge {% if booking.status == 'active' %}bg-success{% else %}bg-secondary{% endif %}">
                                {{ '–ê–∫—Ç–∏–≤–Ω–µ' if booking.status == 'active' else '–°–∫–∞—Å–æ–≤–∞–Ω–µ' }}
                            </span>
                        </p>
                        <p class="text-light"><strong class="text-silver">–ó–∞–±—Ä–æ–Ω—å–æ–≤–∞–Ω–æ:</strong> {{ booking.created_at }}</p>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h5 class="text-silver mb-3">üí∫ –ó–∞–±—Ä–æ–Ω—å–æ–≤–∞–Ω—ñ –º—ñ—Å—Ü—è</h5>
                    <div class="d-flex flex-wrap gap-2 mt-2">
                        {% set seats_list = booking.seats.split(',') %}
                        {% for seat in seats_list %}
                            <span class="btn btn-outline-primary">{{ seat }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-body">
                <h5 class="text-gold">‚ÑπÔ∏è –í–∞–∂–ª–∏–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h5>
                <ul class="list-unstyled mt-3">
                    <li class="text-light mb-2">‚úÖ –ó–±–µ—Ä–µ–∂—ñ—Ç—å –∫–æ–¥ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è - –≤—ñ–Ω –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–≤–∏—Ç–∫—ñ–≤</li>
                    <li class="text-light mb-2">‚úÖ –ü—Ä–∏—Ö–æ–¥—å—Ç–µ –∑–∞ 20 —Ö–≤–∏–ª–∏–Ω –¥–æ –ø–æ—á–∞—Ç–∫—É —Å–µ–∞–Ω—Å—É</li>
                    <li class="text-light mb-2">‚úÖ –ú–∞–π—Ç–µ –ø—Ä–∏ —Å–æ–±—ñ –¥–æ–∫—É–º–µ–Ω—Ç, —â–æ –ø–æ—Å–≤—ñ–¥—á—É—î –æ—Å–æ–±—É</li>
                    <li class="text-light mb-2">‚úÖ –î–µ—Ç–∞–ª—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –±—É–¥—É—Ç—å –Ω–∞–¥—ñ—Å–ª–∞–Ω—ñ –Ω–∞ –≤–∞—à—É email –∞–¥—Ä–µ—Å—É</li>
                </ul>
            </div>
        </div>

        {% if booking.status == 'active' %}
        <div class="card border-warning">
            <div class="card-body">
                <h5 class="text-warning">‚ö†Ô∏è –°–∫–∞—Å—É–≤–∞–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</h5>
                <p class="text-light">–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ —Å–∫–∞—Å—É–≤–∞—Ç–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è, –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ.</p>
                <button class="btn btn-outline-warning" id="cancel-booking-btn">
                    –°–∫–∞—Å—É–≤–∞—Ç–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è
                </button>
            </div>
        </div>
        {% endif %}

        <div class="mt-4 text-center">
            <a href="{{ url_for('index') }}" class="btn btn-primary me-3">–ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
            <a href="{{ url_for('film_details', film_id=booking.film_id) if booking.film_id else url_for('index') }}" 
               class="btn btn-outline-primary">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —ñ–Ω—à—ñ —Å–µ–∞–Ω—Å–∏</a>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è -->
<div class="modal fade" id="cancelModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-gold">–°–∫–∞—Å—É–≤–∞–Ω–Ω—è –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-light">–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ —Å–∫–∞—Å—É–≤–∞—Ç–∏ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è <strong class="text-gold">{{ booking.booking_code }}</strong>?</p>
                <p class="text-danger">–¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä–∏—Ç–∏</button>
                <button type="button" class="btn btn-danger" id="confirm-cancel">–¢–∞–∫, —Å–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const cancelBtn = document.getElementById('cancel-booking-btn');
    const confirmCancelBtn = document.getElementById('confirm-cancel');
    
    if (cancelBtn) {
        cancelBtn.addEventListener('click', function() {
            const cancelModal = new bootstrap.Modal(document.getElementById('cancelModal'));
            cancelModal.show();
        });
    }
    
    if (confirmCancelBtn) {
        confirmCancelBtn.addEventListener('click', async function() {
            try {
                const response = await fetch('/api/cancel-booking/{{ booking.booking_code }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('–ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ —Å–∫–∞—Å–æ–≤–∞–Ω–æ!');
                    location.reload();
                } else {
                    alert('–ü–æ–º–∏–ª–∫–∞: ' + result.message);
                }
            } catch (error) {
                alert('–ü–æ–º–∏–ª–∫–∞ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è: ' + error.message);
            }
        });
    }
});
</script>
{% endblock %}